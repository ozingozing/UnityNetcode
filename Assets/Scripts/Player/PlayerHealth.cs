using System;
using System.Collections;
using System.Collections.Generic;
using Unity.Netcode;
using UnityEngine;

public class PlayerHealth : NetworkBehaviour, IHealth
{
	// 인터페이스에서 정의된 속성 구현
	public int Health { get; set; }

	[SerializeField] private string playerLobbyId;

	[SerializeField] private int currentHealth;
	[SerializeField] private int SetHealth;
	PlayerStats playerStats;
	private void Awake()
	{
		playerStats = GetComponent<PlayerStats>();
	}

	private void Start()
	{
		playerStats.deaths.OnValueChanged += Test;
		currentHealth = SetHealth;
	}

	private void Test(int previousValue, int newValue)
	{
		currentHealth = SetHealth;
	}

	public void InitializePlayerHealth(object sender, System.EventArgs e)
	{
		currentHealth = SetHealth;
	}

	public void TakeDamage(int amount, GameObject attacker)
	{
		currentHealth -= amount;
		if (currentHealth <= 0)
		{
			OnDeath(attacker); // 공격자를 전달하여 죽음 처리
		}
	}

	// 플레이어 사망 처리
	private void OnDeath(GameObject attacker)
	{
		/*// 공격자의 clientId 가져오기
		ulong attackerId = attacker.GetComponent<NetworkObject>().OwnerClientId;

		// 자신의 clientId 가져오기
		ulong victimId = GetComponent<NetworkObject>().OwnerClientId;
*/
		// 킬/데스 처리
		CombatManager.Instance.OnPlayerDeath(attacker, gameObject);
	}
}
